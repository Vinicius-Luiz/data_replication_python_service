{
  "task": {
    "task_name": "replication_employees_history",
    "replication_type": "full_load_and_cdc",
    "interval_seconds": 5,
    "start_mode": "reload",
    "create_table_if_not_exists": true,
    "full_load_settings": {
      "recreate_table_if_exists": true,
      "truncate_before_insert": true
    },
    "cdc_settings": {
      "mode": "scd2",
      "scd2_settings": {
        "start_date_column_name": "scd_start_date",
        "end_date_column_name": "scd_end_date",
        "current_column_name": "scd_current"
      }
    }
  },
  "error_handling": {
    "stop_if_insert_error": false,
    "stop_if_update_error": false,
    "stop_if_delete_error": false,
    "stop_if_upsert_error": false,
    "stop_if_scd2_error": false
  },
  "tables": [
    {
      "schema_name": "employees",
      "table_name": "employee",
      "priority": 0
    },
    {
      "schema_name": "employees",
      "table_name": "department",
      "priority": 0
    },
    {
      "schema_name": "employees",
      "table_name": "salary",
      "priority": 2
    },
    {
      "schema_name": "employees",
      "table_name": "department_manager",
      "priority": 2
    }
  ],
  "filters": [],
  "transformations": [
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "employee"
      },
      "settings": {
        "transformation_type": "modify_table_name",
        "description": "Alterar nome da tabela employee para employee_history",
        "contract": {
          "target_table_name": "employee_history"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_table_name",
        "description": "Alterar nome da tabela salary para salario_historico",
        "contract": {
          "target_table_name": "salario_historico"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "department_manager"
      },
      "settings": {
        "transformation_type": "modify_table_name",
        "description": "Alterar nome da tabela department_manager para department_manager_history",
        "contract": {
          "target_table_name": "department_manager_history"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "department"
      },
      "settings": {
        "transformation_type": "modify_table_name",
        "description": "Alterar nome da tabela department para department_history",
        "contract": {
          "target_table_name": "department_history"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_schema_name",
        "description": "Alterar nome do schema employees para funcionarios na tabela salary",
        "contract": {
          "target_schema_name": "funcionarios"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_column_name",
        "description": "Alterar nome da coluna employee_id para funcionario_id",
        "contract": {
          "column_name": "employee_id",
          "target_column_name": "funcionario_id"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_column_name",
        "description": "Alterar nome da coluna amount para quantia_mensal",
        "contract": {
          "column_name": "amount",
          "target_column_name": "quantia_mensal"
        },
        "priority": 0
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_column_name",
        "description": "Alterar nome da coluna from_date para data_inicio",
        "contract": {
          "column_name": "from_date",
          "target_column_name": "data_inicio"
        },
        "priority": 1
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_column_name",
        "description": "Alterar nome da coluna to_date para data_fim",
        "contract": {
          "column_name": "to_date",
          "target_column_name": "data_fim"
        },
        "priority": 1
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "create_column",
        "description": "Obter a diferença de anos entre data_inicio e data_fim e criar coluna periodo_anos",
        "contract": {
          "operation": "date_diff_years",
          "new_column_name": "periodo_anos",
          "depends_on": ["from_date", "to_date"],
          "round_result": true
        },
        "priority": 2
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "salary"
      },
      "settings": {
        "transformation_type": "modify_column_value",
        "description": "Dividir o valor de quantia_mensal por 12",
        "contract": {
          "operation": "math_expression",
          "column_name": "amount",
          "expression": "value / 12"
        },
        "priority": 2
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "employee"
      },
      "settings": {
        "transformation_type": "modify_column_value",
        "description": "Converter first_name para maiúsculas",
        "contract": {
          "operation": "uppercase",
          "column_name": "first_name"
        },
        "priority": 1
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "employee"
      },
      "settings": {
        "transformation_type": "modify_column_value",
        "description": "Converter last_name para maiúsculas",
        "contract": {
          "operation": "uppercase",
          "column_name": "last_name"
        },
        "priority": 1
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "employee"
      },
      "settings": {
        "transformation_type": "create_column",
        "description": "Concatenar first_name e last_name para criar full_name",
        "contract": {
          "operation": "concat",
          "new_column_name": "full_name",
          "depends_on": ["first_name", "last_name"],
          "separator": " "
        },
        "priority": 2
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "employee"
      },
      "settings": {
        "transformation_type": "create_column",
        "description": "Criar coluna updated_by com valor PYTHON",
        "contract": {
          "operation": "literal",
          "new_column_name": "updated_by",
          "value_type": "varchar",
          "value": "PYTHON"
        },
        "priority": 2
      }
    },
    {
      "table_info": {
        "schema_name": "employees",
        "table_name": "employee"
      },
      "settings": {
        "transformation_type": "create_column",
        "description": "Criar coluna sync_date com data atual",
        "contract": {
          "operation": "datetime_now",
          "new_column_name": "sync_date"
        },
        "priority": 2
      }
    }
  ]
}